 <?php

    $id = isset($_GET['id']) ? absint($_GET['id']) : null;
    if ($id && get_post($id)) {
        $token = isset($_GET['token']) ? sanitize_text_field($_GET['token']) : null;

        //Check token that send in mail
        $check_permission = false;
        $post_token = get_post_meta($id, 'token', true);
        if ($token == $post_token) {
            $check_permission = true;

            //update status if user not admin
            $update_status = false;
            if (is_user_logged_in()) {
                $author_id = (int) get_post_field('post_author', $id);
                if (get_current_user_id() != $author_id) {
                    $update_status = true;
                }
            } else {
                $update_status = true;
            }

            if ($update_status) {
                $status = get_post_meta($id, 'status', true);
                if ($status == 'draft') {
                    update_post_meta($id, 'status', 'viewed');
                }
            }
        }

        if (is_user_logged_in()) {
            $check_permission = true;
        }

        if ($check_permission) {
            echo '<div id="ncpi-invoice"></div>';
        } else {
            //esc_html_e('Sorry!! You don\'t have permission to view this page', 'propovoice'); 
    ?>
         <div class="pi-grid-container pi-main-content">
             <div class="pi-page-content">
                 <svg width="199" height="167" viewBox="0 0 199 167" fill="none" xmlns="http://www.w3.org/2000/svg">
                     <path d="M110.405 166C154.379 166 190.029 130.35 190.029 86.2195C190.029 42.0889 154.222 6.43896 110.405 6.43896C66.4317 6.43896 30.7817 42.0889 30.7817 86.2195C30.7817 130.35 66.4317 166 110.405 166Z" fill="#F1F3F9" stroke="#D6DFE8" stroke-width="2" stroke-miterlimit="10" />
                     <path d="M184.846 33.9225C188.402 33.9225 191.285 31.0396 191.285 27.4835C191.285 23.9273 188.402 21.0445 184.846 21.0445C181.29 21.0445 178.407 23.9273 178.407 27.4835C178.407 31.0396 181.29 33.9225 184.846 33.9225Z" fill="#F1F3F9" />
                     <path d="M194.269 8.7947C196.697 8.7947 198.666 6.82594 198.666 4.39735C198.666 1.96876 196.697 0 194.269 0C191.84 0 189.871 1.96876 189.871 4.39735C189.871 6.82594 191.84 8.7947 194.269 8.7947Z" fill="#F1F3F9" />
                     <path d="M35.0219 33.7654C37.4505 33.7654 39.4192 31.7966 39.4192 29.3681C39.4192 26.9395 37.4505 24.9707 35.0219 24.9707C32.5933 24.9707 30.6245 26.9395 30.6245 29.3681C30.6245 31.7966 32.5933 33.7654 35.0219 33.7654Z" fill="#F1F3F9" />
                     <path d="M8.16651 118.571C12.6768 118.571 16.333 114.915 16.333 110.405C16.333 105.895 12.6768 102.238 8.16651 102.238C3.65627 102.238 0 105.895 0 110.405C0 114.915 3.65627 118.571 8.16651 118.571Z" fill="#F1F3F9" />
                     <path d="M164.587 46.3291L165.843 147.468C165.843 150.923 163.016 153.593 159.561 153.593H60.9348C57.4797 153.593 54.6528 150.766 54.6528 147.468V17.4323C54.6528 13.9772 57.4797 11.3074 60.9348 11.3074H132.392L164.587 46.3291Z" fill="white" stroke="#D6DFE8" stroke-width="2" stroke-miterlimit="10" />
                     <path d="M102.71 133.334H83.3927C82.6074 133.334 81.9792 132.549 81.9792 131.606C81.9792 130.664 82.6074 129.879 83.3927 129.879H102.71C103.495 129.879 104.123 130.664 104.123 131.606C104.123 132.706 103.495 133.334 102.71 133.334Z" fill="#D6DCE8" />
                     <path d="M91.7165 133.334H70.672C69.8867 133.334 69.2585 132.549 69.2585 131.606C69.2585 130.664 69.8867 129.879 70.672 129.879H91.7165C92.5017 129.879 93.1299 130.664 93.1299 131.606C93.1299 132.706 92.5017 133.334 91.7165 133.334Z" fill="#D5DDEA" />
                     <path d="M118.572 32.509H71.3002C70.2008 32.509 69.2585 31.5667 69.2585 30.4673C69.2585 29.368 70.2008 28.4257 71.3002 28.4257H118.572C119.671 28.4257 120.613 29.368 120.613 30.4673C120.613 31.5667 119.671 32.509 118.572 32.509Z" fill="#D6DCE8" />
                     <path d="M89.5178 43.8165H71.3002C70.2008 43.8165 69.2585 42.8742 69.2585 41.7749C69.2585 40.6756 70.2008 39.7333 71.3002 39.7333H89.3607C90.4601 39.7333 91.4024 40.6756 91.4024 41.7749C91.4024 42.8742 90.4601 43.8165 89.5178 43.8165Z" fill="#D6DCE8" />
                     <path d="M132.392 11.3074V39.262C132.392 43.1882 135.847 46.3291 139.773 46.3291H164.587" fill="#D6DCE8" />
                     <path d="M150.549 106.157H96.0591H90.0536H71.8903C71.1579 106.157 70.4255 106.891 70.4255 107.918C70.4255 108.799 71.0114 109.68 71.8903 109.68H90.0536H96.0591H150.549C151.281 109.68 152.014 108.946 152.014 107.918C151.867 106.891 151.281 106.157 150.549 106.157Z" fill="#D6DCE8" />
                     <path d="M150.402 93.386H130.188H123.304H71.8903C71.1579 93.386 70.4255 94.1199 70.4255 95.1475C70.4255 96.0282 71.0114 96.9089 71.8903 96.9089H123.304H130.188H150.402C151.135 96.9089 151.867 96.175 151.867 95.1475C151.721 94.1199 151.135 93.386 150.402 93.386Z" fill="#D6DCE8" />
                     <path d="M150.842 80.4686H145.569H140.295H71.8903C71.1579 80.4686 70.4255 81.2026 70.4255 82.2301C70.4255 83.1108 71.0114 83.9916 71.8903 83.9916H140.295H146.155H150.695C151.428 83.9916 152.16 83.2576 152.16 82.2301C152.307 81.3494 151.574 80.4686 150.842 80.4686Z" fill="#D6DCE8" />
                     <path d="M93.4225 134.634H71.8903C71.1579 134.634 70.4255 133.9 70.4255 132.872C70.4255 131.992 71.0114 131.111 71.8903 131.111H93.4225C94.1549 131.111 94.8873 131.845 94.8873 132.872C94.8873 134.047 94.1549 134.634 93.4225 134.634Z" fill="#E3EAF2" />
                     <path d="M151.428 67.6981H134.29H130.042H71.8903C71.1579 67.6981 70.4255 68.4321 70.4255 69.4596C70.4255 70.3403 71.0114 71.221 71.8903 71.221H130.042H134.29H151.281C152.307 71.221 152.893 70.4871 152.893 69.4596C152.893 68.5789 152.307 67.6981 151.428 67.6981Z" fill="#D6DCE8" />
                     <path d="M73.0623 142.414H38.4936C34.6852 142.414 31.6091 139.331 31.6091 135.515V87.5146C31.6091 74.1568 42.4485 63.4412 55.6315 63.4412C68.8145 63.4412 79.6538 74.3036 79.6538 87.5146V135.661C79.8003 139.331 76.7243 142.414 73.0623 142.414ZM45.378 128.762H66.1779V87.5146C66.1779 81.7898 61.4906 77.0926 55.778 77.0926C50.0653 77.0926 45.378 81.7898 45.378 87.5146V128.762Z" fill="#D6DCE8" stroke="#AAB2C5" stroke-width="2" stroke-miterlimit="10" />
                     <path d="M87.2705 155.478H24.7245C20.4766 155.478 16.9612 151.955 16.9612 147.698V106.157C16.9612 101.9 20.4766 98.377 24.7245 98.377H87.2705C91.5183 98.377 95.0338 101.9 95.0338 106.157V147.698C95.0338 151.955 91.5183 155.478 87.2705 155.478Z" fill="#D6DCE8" stroke="#AAB2C5" stroke-width="2" stroke-miterlimit="10" />
                     <path d="M59.9804 127.93C62.0825 126.587 63.5255 124.215 63.5255 121.477C63.5255 117.252 60.1459 113.862 55.9242 113.862C51.7026 113.862 48.323 117.252 48.323 121.477C48.323 124.215 49.766 126.587 51.8681 127.93V134.462C51.8681 136.728 53.6585 138.525 55.9242 138.525C58.19 138.525 59.9804 136.728 59.9804 134.462V127.93Z" fill="white" stroke="#AAB2C5" stroke-width="2" />
                 </svg>
                 <p>Sorry!! You don't have permission to view this page</p>
             </div>
         </div>
     <?php
        }
    } else { ?>
     <div class="pi-grid-container pi-main-content">
         <div class="pi-page-content">
             <svg width="270" height="170" viewBox="0 0 270 170" fill="none" xmlns="http://www.w3.org/2000/svg">
                 <path d="M146.743 162.431C190.991 162.431 226.863 126.559 226.863 82.1528C226.863 37.7467 190.833 1.87421 146.743 1.87421C102.495 1.87421 66.6221 37.7467 66.6221 82.1528C66.6221 126.559 102.495 162.431 146.743 162.431Z" fill="#F1F3F9" stroke="#D6DCE8" stroke-width="2" stroke-miterlimit="10" />
                 <path d="M237.034 56.7174C240.612 56.7174 243.513 53.8166 243.513 50.2382C243.513 46.6599 240.612 43.759 237.034 43.759C233.456 43.759 230.555 46.6599 230.555 50.2382C230.555 53.8166 233.456 56.7174 237.034 56.7174Z" fill="#F1F3F9" />
                 <path d="M246.516 31.4331C248.959 31.4331 250.94 29.4521 250.94 27.0083C250.94 24.5645 248.959 22.5835 246.516 22.5835C244.072 22.5835 242.091 24.5645 242.091 27.0083C242.091 29.4521 244.072 31.4331 246.516 31.4331Z" fill="#F1F3F9" />
                 <path d="M70.2563 29.529C72.7001 29.529 74.6812 27.5479 74.6812 25.1042C74.6812 22.6604 72.7001 20.6794 70.2563 20.6794C67.8126 20.6794 65.8315 22.6604 65.8315 25.1042C65.8315 27.5479 67.8126 29.529 70.2563 29.529Z" fill="#F1F3F9" />
                 <path d="M43.2336 114.865C47.772 114.865 51.4511 111.186 51.4511 106.647C51.4511 102.109 47.772 98.4299 43.2336 98.4299C38.6952 98.4299 35.0161 102.109 35.0161 106.647C35.0161 111.186 38.6952 114.865 43.2336 114.865Z" fill="#F1F3F9" />
                 <path d="M113.047 132.892L51.5734 153.481C50.6692 153.736 49.7656 153.36 49.5107 152.455L18.8572 60.6802C18.6023 59.776 18.9785 58.8724 19.8827 58.6175L81.3563 38.0286C82.2605 37.7738 83.164 38.15 83.4189 39.0542L114.175 130.812C114.413 131.614 113.951 132.637 113.047 132.892Z" fill="white" stroke="#C5CCDA" stroke-width="2" stroke-miterlimit="10" />
                 <circle opacity="0.4" cx="73.1187" cy="71.4273" r="3.34396" transform="rotate(-18.7994 73.1187 71.4273)" fill="#D6DCE8" />
                 <path d="M71.7977 80.9909C73.123 80.5397 73.8723 79.017 73.4211 77.6917C72.9699 76.3664 71.4473 75.6171 70.1219 76.0683C68.7966 76.5194 68.0474 78.0421 68.4985 79.3674C68.9819 80.7874 70.3777 81.4742 71.7977 80.9909Z" fill="#AAB2C5" />
                 <path d="M68.8608 86.6384L67.6301 87.0574C65.8154 85.1399 62.7801 85.2224 60.9895 87.0996C60.2664 87.7683 59.7669 88.7834 59.6782 89.7643L58.4476 90.1832C58.4899 86.8941 61.3822 84.2194 64.6089 84.3886C66.1276 84.5054 67.7449 85.2225 68.8608 86.6384Z" fill="#AAB2C5" />
                 <path d="M52.8646 87.4359C54.1899 86.9848 54.9392 85.4621 54.488 84.1368C54.0368 82.8115 52.5142 82.0622 51.1888 82.5133C49.8635 82.9645 49.1142 84.4872 49.5654 85.8125C50.1434 87.2002 51.5392 87.8871 52.8646 87.4359Z" fill="#AAB2C5" />
                 <path d="M66.5049 119.302L65.6947 116.922L68.9349 103.457L70.9196 102.782L72.0732 106.17L70.8629 106.582L68.6891 115.668L68.7331 115.797L78.5196 112.466L79.3573 114.926L66.5049 119.302ZM75.431 119.684L74.1402 115.892L73.8099 114.816L69.8385 103.15L72.6623 102.189L78.2871 118.712L75.431 119.684Z" fill="#AAB2C5" />
                 <path d="M175.933 142.187L105.748 142.341C104.733 142.389 103.999 141.556 103.951 140.54L103.732 35.9392C103.684 34.924 104.518 34.1897 105.533 34.1417L175.717 33.9869C176.733 33.9389 177.467 34.7727 177.515 35.7879L177.734 140.389C177.67 141.397 176.948 142.139 175.933 142.187Z" fill="white" stroke="#C5CCDA" stroke-width="2" stroke-miterlimit="10" />
                 <path d="M131.346 91.8367L165.052 91.7683" stroke="#D6DCE8" stroke-opacity="0.2" stroke-width="2" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round" />
                 <path d="M131.352 85.692L164.962 85.6176" stroke="#D6DCE8" stroke-opacity="0.2" stroke-width="2" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round" />
                 <path d="M131.34 97.9812L165.046 97.9128" stroke="#D6DCE8" stroke-opacity="0.2" stroke-width="2" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round" />
                 <path d="M115.59 104.086L165.046 103.962" stroke="#D6DCE8" stroke-opacity="0.2" stroke-width="2" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round" />
                 <path d="M115.584 110.231L143.861 110.106" stroke="#D6DCE8" stroke-opacity="0.2" stroke-width="2" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round" />
                 <path d="M115.642 130.768L122.654 130.733" stroke="#D6DCE8" stroke-width="2" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round" />
                 <path d="M115.66 125.969L128.051 125.891" stroke="#D6DCE8" stroke-width="2" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round" />
                 <path d="M152.826 125.832L165.116 125.844" stroke="#D6DCE8" stroke-width="2" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round" />
                 <circle opacity="0.4" cx="157.364" cy="65.4521" r="3.61755" fill="#D6DCE8" />
                 <circle opacity="0.4" cx="126.356" cy="65.4521" r="3.61755" fill="#D6DCE8" />
                 <path d="M152.366 55.2647C153.766 55.2647 154.966 54.0647 154.966 52.6647C154.966 51.2647 153.766 50.0647 152.366 50.0647C150.966 50.0647 149.766 51.2647 149.766 52.6647C149.766 54.1647 150.866 55.2647 152.366 55.2647Z" fill="#AAB2C5" />
                 <path d="M147.766 59.6647H146.466C145.366 57.2647 142.466 56.3647 140.166 57.5647C139.266 57.9647 138.466 58.7647 138.066 59.6647H136.766C137.866 56.5647 141.466 54.9647 144.466 56.1647C145.866 56.7647 147.166 57.9647 147.766 59.6647Z" fill="#AAB2C5" />
                 <path d="M132.366 55.2647C133.766 55.2647 134.966 54.0647 134.966 52.6647C134.966 51.2647 133.766 50.0647 132.366 50.0647C130.966 50.0647 129.766 51.2647 129.766 52.6647C129.866 54.1647 130.966 55.2647 132.366 55.2647Z" fill="#AAB2C5" />
                 <path d="M142.265 107.397C140.861 107.397 139.657 107.042 138.651 106.332C137.651 105.616 136.881 104.585 136.341 103.238C135.807 101.886 135.54 100.258 135.54 98.3545C135.546 96.4511 135.816 94.8317 136.35 93.4965C136.89 92.1556 137.659 91.1329 138.659 90.4283C139.665 89.7238 140.867 89.3715 142.265 89.3715C143.662 89.3715 144.864 89.7238 145.87 90.4283C146.875 91.1329 147.645 92.1556 148.179 93.4965C148.719 94.8374 148.989 96.4567 148.989 98.3545C148.989 100.264 148.719 101.894 148.179 103.247C147.645 104.593 146.875 105.622 145.87 106.332C144.87 107.042 143.668 107.397 142.265 107.397ZM142.265 104.729C143.355 104.729 144.216 104.193 144.847 103.119C145.483 102.039 145.801 100.451 145.801 98.3545C145.801 96.9681 145.657 95.8033 145.367 94.8602C145.077 93.917 144.668 93.2067 144.14 92.7295C143.611 92.2465 142.986 92.005 142.265 92.005C141.179 92.005 140.321 92.5448 139.691 93.6244C139.06 94.6982 138.742 96.2749 138.736 98.3545C138.73 99.7465 138.87 100.917 139.154 101.866C139.444 102.815 139.853 103.531 140.381 104.014C140.909 104.491 141.537 104.729 142.265 104.729Z" fill="#AAB2C5" />
                 <path d="M255.472 105.62L192.618 121.351C191.712 121.6 190.826 121.059 190.578 120.153L167.105 26.3241C166.856 25.4181 167.397 24.533 168.303 24.2843L231.158 8.55273C232.064 8.30407 232.949 8.84523 233.197 9.75118L256.67 103.58C256.919 104.486 256.378 105.371 255.472 105.62Z" fill="white" stroke="#C5CCDA" stroke-width="2" stroke-miterlimit="10" />
                 <path d="M183.861 64.3563L191.652 95.4442L242.514 82.6977L234.723 51.6098L183.861 64.3563Z" stroke="#D6DCE8" stroke-width="2" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round" />
                 <path d="M195.233 109.463L202.393 107.707" stroke="#D6DCE8" stroke-width="2" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round" />
                 <path d="M193.925 104.526L206.625 101.331" stroke="#D6DCE8" stroke-width="2" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round" />
                 <path d="M233.28 97.824L245.98 94.6285" stroke="#D6DCE8" stroke-width="2" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round" />
                 <path d="M215.412 40.259C216.772 39.9285 217.655 38.4791 217.325 37.1186C216.994 35.7582 215.545 34.8755 214.184 35.2061C212.824 35.5366 211.941 36.986 212.272 38.3464C212.626 39.804 213.954 40.6132 215.412 40.259Z" fill="#AAB2C5" />
                 <path d="M211.981 45.6208L210.718 45.9277C209.082 43.8553 206.051 43.6655 204.1 45.3746C203.32 45.9758 202.731 46.9421 202.555 47.9111L201.292 48.218C201.629 44.9459 204.749 42.5412 207.948 42.9989C209.45 43.2514 210.996 44.1105 211.981 45.6208Z" fill="#AAB2C5" />
                 <path d="M195.977 44.9813C197.338 44.6508 198.221 43.2013 197.89 41.8409C197.559 40.4805 196.11 39.5978 194.75 39.9283C193.389 40.2589 192.506 41.7083 192.837 43.0687C193.288 44.5027 194.617 45.3119 195.977 44.9813Z" fill="#AAB2C5" />
                 <path d="M207.809 79.7435L207.216 77.3004L211.649 64.1806L213.686 63.6855L214.532 67.1638L213.289 67.4657L210.31 76.3202L210.343 76.4527L220.388 74.0113L221.002 76.5372L207.809 79.7435ZM216.666 80.9241L215.72 77.0317L215.487 75.9305L212.577 63.9552L215.475 63.2507L219.597 80.2116L216.666 80.9241Z" fill="#AAB2C5" />
             </svg>
             <p>We Con't find this page you're looking for</p>
         </div>
     </div>
 <?php
        //esc_html_e('Sorry!! page not found', 'propovoice');
    }
